<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap      
	PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="cz">
	<!-- 无关联查询返回结果 -->
	<resultMap class="java.util.HashMap" id="queryCatDataResult">
        <result property="ID" column="ID" javaType="String"/>
        <result property="SEQUEN_NAME" column="SEQUEN_NAME" javaType="String"/>
        <result property="O_TIME" column="O_TIME" javaType="java.util.Date"/>
        <result property="O_TIME_FRAC" column="O_TIME_FRAC" javaType="Integer"/>
        <result property="EPI_LAT" column="EPI_LAT" javaType="Double"/>
        <result property="EPI_LON" column="EPI_LON" javaType="Double"/>
        <result property="EPI_DEPTH" column="EPI_DEPTH" javaType="Double"/>
        <result property="M" column="M" javaType="Double"/>
        <result property="M_SOURCE" column="M_SOURCE" javaType="String"/>
        <result property="QLOC" column="QLOC" javaType="String"/>
        <result property="QCOM" column="QCOM" javaType="String"/>
        <result property="LOCATION_CNAME" column="LOCATION_CNAME" javaType="String"/>
        <result property="Location_sname" column="Location_sname" javaType="String"/>
        <result property="EVENT_ID" column="EVENT_ID" javaType="String"/>
        <result property="NET_CODE" column="NET_CODE" javaType="String"/>
        <result property="Save_time" column="Save_time" javaType="java.util.Date"/>
        <result property="Auto_flag" column="Auto_flag" javaType="String"/>
        <result property="Operator" column="Operator" javaType="String"/>
        <result property="Loc_program" column="Loc_program" javaType="String"/>
        <result property="Eq_type" column="Eq_type" javaType="String"/>
        <result property="Depfix_flag" column="Depfix_flag" javaType="Integer"/>
        <result property="SPmin" column="SPmin" javaType="Double"/>
        <result property="Dmin" column="Dmin" javaType="Double"/>
        <result property="Gap_azi" column="Gap_azi" javaType="Double"/>
        <result property="Rms" column="Rms" javaType="Double"/>
        <result property="Erh" column="Erh" javaType="Double"/>
        <result property="Erz" column="Erz" javaType="Double"/>
        <result property="Qnet" column="Qnet" javaType="String"/>
        <result property="Sum_stn" column="Sum_stn" javaType="Integer"/>
        <result property="Loc_stn" column="Loc_stn" javaType="Integer"/>
        <result property="Sum_pha" column="Sum_pha" javaType="Integer"/>
        <result property="Loc_pha" column="Loc_pha" javaType="Integer"/>
        <result property="Epic_id" column="Epic_id" javaType="String"/>
        <result property="Source_id" column="Source_id" javaType="String"/>
        <result property="FE_num" column="FE_num" javaType="Integer"/>
        <result property="FE_sname" column="FE_sname" javaType="String"/>
        <result property="FE_cname" column="FE_cname" javaType="String"/>
        <result property="Eq_name" column="Eq_name" javaType="String"/>
        <result property="Model_name" column="Model_name" javaType="String"/>
        <result property="Remark" column="Remark" javaType="String"/>
        <result property="Lock_flag" column="Lock_flag" javaType="String"/>
        <result property="Group_id" column="Group_id" javaType="String"/>
    </resultMap>
    
    <!-- 关联震级震相查询结果，多字段MAG_VAL -->
    <resultMap class="java.util.HashMap" id="queryCatMagDataResult">
    	<result property="ID" column="ID" javaType="String"/>
        <result property="SEQUEN_NAME" column="SEQUEN_NAME" javaType="String"/>
        <result property="O_TIME" column="O_TIME" javaType="java.util.Date"/>
        <result property="O_TIME_FRAC" column="O_TIME_FRAC" javaType="Integer"/>
        <result property="EPI_LAT" column="EPI_LAT" javaType="Double"/>
        <result property="EPI_LON" column="EPI_LON" javaType="Double"/>
        <result property="EPI_DEPTH" column="EPI_DEPTH" javaType="Double"/>
        <result property="M" column="M" javaType="Double"/>
        <result property="MAG_VAL" column="MAG_VAL" javaType="Double"/>
        <result property="M_SOURCE" column="M_SOURCE" javaType="String"/>
        <result property="QLOC" column="QLOC" javaType="String"/>
        <result property="QCOM" column="QCOM" javaType="String"/>
        <result property="LOCATION_CNAME" column="LOCATION_CNAME" javaType="String"/>   
        <result property="EVENT_ID" column="EVENT_ID" javaType="String"/>
        <result property="MAGC_ID" column="MAGC_ID" javaType="String"/>  	
    </resultMap>
    <!-- 无震级关联的地震目录查询 -->
	<select id="queryCatData" parameterClass="quake.seismic.data.catalog.model.Criteria"
		resultMap="queryCatDataResult">    
		<![CDATA[
		SELECT ID,SEQUEN_NAME,O_TIME,O_TIME_FRAC,EPI_LAT,EPI_LON,EPI_DEPTH,M,M_SOURCE,QLOC,QCOM,LOCATION_CNAME,EVENT_ID,
		       NET_CODE,Location_sname,Save_time,Auto_flag,Operator,Loc_program,Eq_type,Depfix_flag,SPmin,Dmin,Gap_azi,
		       Rms,Erh,Erz,Qnet,Sum_stn,Loc_stn,Sum_pha,Loc_pha,Epic_id,Source_id,FE_num,FE_sname,FE_cname,
		       Eq_name,Model_name,Remark,Lock_flag,Group_id
		FROM $schema$.$tableName$
		]]>
		<dynamic prepend="WHERE">
			<!-- 台网查询条件 -->
		    <isNotEmpty prepend="AND" property="netCode">
		       <![CDATA[(NET_CODE=#netCode#)]]>
		    </isNotEmpty>
		    <!-- 震中地名查询条件 -->
		    <isNotEmpty prepend="AND" property="location">
		       <![CDATA[(LOCATION_CNAME LIKE '%$location$%')]]>
		    </isNotEmpty>
			<isNotEmpty property="startDate">
				<isNotEmpty prepend="AND" property="endDate">
				<![CDATA[
				((O_TIME>=#startDate#) AND (O_TIME<=#endDate#))
				]]>
				</isNotEmpty>
			</isNotEmpty>
			<isNotEmpty property="startDate">
				<isEmpty prepend="AND" property="endDate">
				<![CDATA[(O_TIME>=#startDate#)]]>
				</isEmpty>
			</isNotEmpty>
			<isNotEmpty property="endDate">
				<isEmpty prepend="AND" property="startDate">
				<![CDATA[(O_TIME<=#endDate#)]]>
				</isEmpty>
			</isNotEmpty>
			
			<isNotNull property="startLat">
				<isNotNull prepend="AND" property="endLat">
				<![CDATA[
				((EPI_LAT>=#startLat#) AND (EPI_LAT<=#endLat#))
				]]>
				</isNotNull>
			</isNotNull>
			<isNotNull property="startLat">
				<isNull prepend="AND" property="endLat">
				<![CDATA[(EPI_LAT>=#startLat#)]]>
				</isNull>
			</isNotNull>
			<isNotNull property="endLat">
				<isNull prepend="AND" property="startLat">
				<![CDATA[(EPI_LAT<=#endLat#)]]>
				</isNull>
			</isNotNull>
			
			<isNotNull property="startLon">
				<isNotNull prepend="AND" property="endLon">
				<![CDATA[
				((EPI_LON>=#startLon#) AND (EPI_LON<=#endLon#))
				]]>
				</isNotNull>
			</isNotNull>
			<isNotNull property="startLon">
				<isNull prepend="AND" property="endLon">
				<![CDATA[(EPI_LON>=#startLon#)]]>
				</isNull>
			</isNotNull>
			<isNotNull property="endLon">
				<isNull prepend="AND" property="startLon">
				<![CDATA[(EPI_LON<=#endLon#)]]>
				</isNull>
			</isNotNull>
			
			<isNotNull property="startM">
				<isNotNull prepend="AND" property="endM">
				<![CDATA[
				((M>=#startM#) AND (M<=#endM#))
				]]>
				</isNotNull>
			</isNotNull>
			<isNotNull property="startM">
				<isNull prepend="AND" property="endM">
				<![CDATA[(M>=#startM#)]]>
				</isNull>
			</isNotNull>
			<isNotNull property="endM">
				<isNull prepend="AND" property="startM">
				<![CDATA[(M<=#endM#)]]>
				</isNull>
			</isNotNull>
			<!--只显示大于-10的震级-->
			<isNull property="startM">
				<isNull prepend="AND" property="endM">
					<![CDATA[(M>-10)]]>
				</isNull>
			</isNull>
		</dynamic>
		
		<dynamic prepend="ORDER BY">
			<isNotEmpty property="sortProperty">
				<isNotEmpty property="sortDir">
					<![CDATA[$sortProperty$ $sortDir$]]>
				</isNotEmpty>
			</isNotEmpty>
			
			<isEmpty property="sortProperty">
				<isEmpty property="sortDir">
					<![CDATA[O_TIME desc]]>
				</isEmpty>
			</isEmpty>
			<!-- 地震目录分页查询条件 -->
			<isNotEmpty property="start">
				<isGreaterThan property="size" compareValue="0">
					LIMIT <![CDATA[$start$,$size$]]>
				</isGreaterThan>
			</isNotEmpty>
		</dynamic>
	</select>
	
	<select id="queryCatDataCount" parameterClass="quake.seismic.data.catalog.model.Criteria"
		resultClass="Integer">         
		<![CDATA[
		SELECT count(0)
		FROM $schema$.$tableName$
		]]>
		<dynamic prepend="WHERE">
			<!-- 台网查询条件 -->
		    <isNotEmpty prepend="AND" property="netCode">
		       <![CDATA[(NET_CODE=#netCode#)]]>
		    </isNotEmpty>
		    <!-- 震中地名查询条件 -->
		    <isNotEmpty prepend="AND" property="location">
		       <![CDATA[(LOCATION_CNAME LIKE '%$location$%')]]>
		    </isNotEmpty>
			<isNotEmpty property="startDate">
				<isNotEmpty prepend="AND" property="endDate">
				<![CDATA[
				((O_TIME>=#startDate#) AND (O_TIME<=#endDate#))
				]]>
				</isNotEmpty>
			</isNotEmpty>
			<isNotEmpty property="startDate">
				<isEmpty prepend="AND" property="endDate">
				<![CDATA[(O_TIME>=#startDate#)]]>
				</isEmpty>
			</isNotEmpty>
			<isNotEmpty property="endDate">
				<isEmpty prepend="AND" property="startDate">
				<![CDATA[(O_TIME<=#endDate#)]]>
				</isEmpty>
			</isNotEmpty>
			
			<isNotNull property="startLat">
				<isNotNull prepend="AND" property="endLat">
				<![CDATA[
				((EPI_LAT>=#startLat#) AND (EPI_LAT<=#endLat#))
				]]>
				</isNotNull>
			</isNotNull>
			<isNotNull property="startLat">
				<isNull prepend="AND" property="endLat">
				<![CDATA[(EPI_LAT>=#startLat#)]]>
				</isNull>
			</isNotNull>
			<isNotNull property="endLat">
				<isNull prepend="AND" property="startLat">
				<![CDATA[(EPI_LAT<=#endLat#)]]>
				</isNull>
			</isNotNull>
			
			<isNotNull property="startLon">
				<isNotNull prepend="AND" property="endLon">
				<![CDATA[
				((EPI_LON>=#startLon#) AND (EPI_LON<=#endLon#))
				]]>
				</isNotNull>
			</isNotNull>
			<isNotNull property="startLon">
				<isNull prepend="AND" property="endLon">
				<![CDATA[(EPI_LON>=#startLon#)]]>
				</isNull>
			</isNotNull>
			<isNotNull property="endLon">
				<isNull prepend="AND" property="startLon">
				<![CDATA[(EPI_LON<=#endLon#)]]>
				</isNull>
			</isNotNull>
			
			<isNotNull property="startM">
				<isNotNull prepend="AND" property="endM">
				<![CDATA[
				((M>=#startM#) AND (M<=#endM#))
				]]>
				</isNotNull>
			</isNotNull>
			<isNotNull property="startM">
				<isNull prepend="AND" property="endM">
				<![CDATA[(M>=#startM#)]]>
				</isNull>
			</isNotNull>
			<isNotNull property="endM">
				<isNull prepend="AND" property="startM">
				<![CDATA[(M<=#endM#)]]>
				</isNull>
			</isNotNull>
			<!--只显示大于-10的震级-->
			<isNull property="startM">
				<isNull prepend="AND" property="endM">
					<![CDATA[(M>-10)]]>
				</isNull>
			</isNull>
		</dynamic>
	</select>
	
	 <!-- 有震级关联的地震目录查询 -->
	<select id="queryCatMagData" parameterClass="quake.seismic.data.catalog.model.Criteria"
		resultMap="queryCatMagDataResult">    
		<![CDATA[
		select DISTINCT CL.ID,CL.SEQUEN_NAME,CL.O_TIME,CL.O_TIME_FRAC,CL.EPI_LAT,CL.EPI_LON,CL.EPI_DEPTH,CL.M as M,MC.MAG_VAL as MAG_VAL,CL.M_SOURCE,CL.QLOC,CL.QCOM,CL.LOCATION_CNAME,EVENT_ID,MC.ID as MAGC_ID 
		FROM $schema$.$tableName$  CL LEFT JOIN $schema$.$magTname$ MC ON CL.ID = MC.CATALOG_ID AND CL.M_SOURCE = MC.MAG_NAME
		]]>
		<dynamic prepend="WHERE">
			<isNotEmpty property="startDate">
				<isNotEmpty prepend="AND" property="endDate">
				<![CDATA[
				((CL.O_TIME>=#startDate#) AND (CL.O_TIME<=#endDate#))
				]]>
				</isNotEmpty>
			</isNotEmpty>
			<isNotEmpty property="startDate">
				<isEmpty prepend="AND" property="endDate">
				<![CDATA[(CL.O_TIME>=#startDate#)]]>
				</isEmpty>
			</isNotEmpty>
			<isNotEmpty property="endDate">
				<isEmpty prepend="AND" property="startDate">
				<![CDATA[(CL.O_TIME<=#endDate#)]]>
				</isEmpty>
			</isNotEmpty>
			
			<isNotNull property="startLat">
				<isNotNull prepend="AND" property="endLat">
				<![CDATA[
				((CL.EPI_LAT>=#startLat#) AND (CL.EPI_LAT<=#endLat#))
				]]>
				</isNotNull>
			</isNotNull>
			<isNotNull property="startLat">
				<isNull prepend="AND" property="endLat">
				<![CDATA[(CL.EPI_LAT>=#startLat#)]]>
				</isNull>
			</isNotNull>
			<isNotNull property="endLat">
				<isNull prepend="AND" property="startLat">
				<![CDATA[(CL.EPI_LAT<=#endLat#)]]>
				</isNull>
			</isNotNull>
			
			<isNotNull property="startLon">
				<isNotNull prepend="AND" property="endLon">
				<![CDATA[
				((CL.EPI_LON>=#startLon#) AND (CL.EPI_LON<=#endLon#))
				]]>
				</isNotNull>
			</isNotNull>
			<isNotNull property="startLon">
				<isNull prepend="AND" property="endLon">
				<![CDATA[(CL.EPI_LON>=#startLon#)]]>
				</isNull>
			</isNotNull>
			<isNotNull property="endLon">
				<isNull prepend="AND" property="startLon">
				<![CDATA[(CL.EPI_LON<=#endLon#)]]>
				</isNull>
			</isNotNull>
			<!-- 关联震级表查询，按照震级表中的震级作为查询条件 -->
			<!--
			<isNotNull property="startM">
				<isNotNull prepend="AND" property="endM">
				<![CDATA[
				((MC.MAG_VAL>=#startM# AND MC.MAG_VAL<=#endM#) OR (CL.M>=#startM# AND CL.M<=#endM#))
				]]>
				</isNotNull>
			</isNotNull>
			<isNotNull property="startM">
				<isNull prepend="AND" property="endM">
				<![CDATA[(MC.MAG_VAL>=#startM# OR CL.M>=#startM#)]]>
				</isNull>
			</isNotNull>
			<isNotNull property="endM">
				<isNull prepend="AND" property="startM">
				<![CDATA[(MC.MAG_VAL<=#endM# OR CL.M<=#endM#)]]>
				</isNull>
			</isNotNull>
			-->
			<!--只显示大于-10的震级,两个震级有一个>-10就可以-->
			<!--
			<isNull property="startM">
				<isNull prepend="AND" property="endM">
					<![CDATA[(MC.MAG_VAL>-10 OR CL.M>-10)]]>
				</isNull>
			</isNull>
			-->
			<isNotNull property="startM">
				<isNotNull prepend="AND" property="endM">
				<![CDATA[
				(CL.M>=#startM# AND CL.M<=#endM#)
				]]>
				</isNotNull>
			</isNotNull>
			<isNotNull property="startM">
				<isNull prepend="AND" property="endM">
				<![CDATA[CL.M>=#startM#]]>
				</isNull>
			</isNotNull>
			<isNotNull property="endM">
				<isNull prepend="AND" property="startM">
				<![CDATA[CL.M<=#endM#]]>
				</isNull>
			</isNotNull>
			<!--只显示大于-10的震级,两个震级有一个>-10就可以-->
			<isNull property="startM">
				<isNull prepend="AND" property="endM">
					<![CDATA[CL.M>-10]]>
				</isNull>
			</isNull>
		</dynamic>
		
		<dynamic prepend="ORDER BY">
			<isNotEmpty property="sortProperty">
				<isNotEmpty property="sortDir">
					<![CDATA[$sortProperty$ $sortDir$]]>
				</isNotEmpty>
			</isNotEmpty>
			
			<isEmpty property="sortProperty">
				<isEmpty property="sortDir">
					<![CDATA[CL.O_TIME desc]]>
				</isEmpty>
			</isEmpty>
		</dynamic>
		LIMIT $start$, $size$
	</select>
	<select id="queryCatMagDataCount" parameterClass="quake.seismic.data.catalog.model.Criteria"
		resultClass="Integer">         
		<![CDATA[
		SELECT count(0)
		FROM $schema$.$tableName$ CL
		]]>
		<dynamic prepend="WHERE">
			<isNotEmpty property="startDate">
				<isNotEmpty prepend="AND" property="endDate">
				<![CDATA[
				((CL.O_TIME>=#startDate#) AND (CL.O_TIME<=#endDate#))
				]]>
				</isNotEmpty>
			</isNotEmpty>
			<isNotEmpty property="startDate">
				<isEmpty prepend="AND" property="endDate">
				<![CDATA[(CL.O_TIME>=#startDate#)]]>
				</isEmpty>
			</isNotEmpty>
			<isNotEmpty property="endDate">
				<isEmpty prepend="AND" property="startDate">
				<![CDATA[(CL.O_TIME<=#endDate#)]]>
				</isEmpty>
			</isNotEmpty>
			
			<isNotNull property="startLat">
				<isNotNull prepend="AND" property="endLat">
				<![CDATA[
				((CL.EPI_LAT>=#startLat#) AND (CL.EPI_LAT<=#endLat#))
				]]>
				</isNotNull>
			</isNotNull>
			<isNotNull property="startLat">
				<isNull prepend="AND" property="endLat">
				<![CDATA[(CL.EPI_LAT>=#startLat#)]]>
				</isNull>
			</isNotNull>
			<isNotNull property="endLat">
				<isNull prepend="AND" property="startLat">
				<![CDATA[(CL.EPI_LAT<=#endLat#)]]>
				</isNull>
			</isNotNull>
			
			<isNotNull property="startLon">
				<isNotNull prepend="AND" property="endLon">
				<![CDATA[
				((CL.EPI_LON>=#startLon#) AND (CL.EPI_LON<=#endLon#))
				]]>
				</isNotNull>
			</isNotNull>
			<isNotNull property="startLon">
				<isNull prepend="AND" property="endLon">
				<![CDATA[(CL.EPI_LON>=#startLon#)]]>
				</isNull>
			</isNotNull>
			<isNotNull property="endLon">
				<isNull prepend="AND" property="startLon">
				<![CDATA[(CL.EPI_LON<=#endLon#)]]>
				</isNull>
			</isNotNull>
			
			<isNotNull property="startM">
				<isNotNull prepend="AND" property="endM">
				<![CDATA[
				(CL.M>=#startM# AND CL.M<=#endM#)
				]]>
				</isNotNull>
			</isNotNull>
			<isNotNull property="startM">
				<isNull prepend="AND" property="endM">
				<![CDATA[CL.M>=#startM#]]>
				</isNull>
			</isNotNull>
			<isNotNull property="endM">
				<isNull prepend="AND" property="startM">
				<![CDATA[CL.M<=#endM#]]>
				</isNull>
			</isNotNull>
			<!--只显示大于-10的震级,两个震级有一个>-10就可以-->
			<isNull property="startM">
				<isNull prepend="AND" property="endM">
					<![CDATA[CL.M>-10]]>
				</isNull>
			</isNull>
		</dynamic>
	</select>
	
	<select id="queryMagData" parameterClass="quake.seismic.data.catalog.model.MagCriteria"
		resultClass="Double">         
		<![CDATA[
		select MAG_VAL from $schema$.$tableName$ WHERE CATALOG_ID = #catId# and MAG_NAME = #magName# 
		]]>
	</select>
	
	<resultMap class="java.util.HashMap" id="queryMagMResult">
        <result property="MAG_NAME" column="MAG_NAME" javaType="String"/>
        <result property="MAG_VAL" column="MAG_VAL" javaType="Double"/>
        <result property="MAG_GAP" column="MAG_GAP" javaType="Double"/>
        <result property="MAG_STN" column="MAG_STN" javaType="Integer"/>
        <!-- 目前数据库中没有该字段
        <result property="MAG_ERROR" column="MAG_ERROR" javaType="Double"/>
         -->
        <result property="REMARK" column="REMARK" javaType="String"/>
    </resultMap>
	<select id="queryMagM" parameterClass="quake.seismic.data.catalog.model.MagCriteria"
			resultMap="queryMagMResult">
		<![CDATA[
			select MAG_NAME,MAG_VAL,MAG_GAP,MAG_STN,REMARK
			from $schema$.$tableName$ WHERE CATALOG_ID = #catId#
		]]>
	</select>
	
	<!-- 台网信息查询结果 -->
    <resultMap class="java.util.HashMap" id="queryNetworkInfoResult">
    	<result property="Net_code" column="Net_code" javaType="String"/>
        <result property="Net_cname" column="Net_cname" javaType="String"/>
        <result property="Net_sname" column="Net_sname" javaType="String"/>
        <result property="Net_Lat" column="Net_Lat" javaType="Double"/>
        <result property="Net_lon" column="Net_lon" javaType="Double"/>
        <result property="Net_elev" column="Net_elev" javaType="Double"/>
        <result property="Net_type" column="Net_type" javaType="String"/>
        <result property="Net_startdate" column="Net_startdate" javaType="java.util.Date"/>
        <result property="Net_enddate" column="Net_enddate" javaType="java.util.Date"/>
        <result property="Sta_num" column="Sta_num" javaType="Integer"/>
        <result property="Director" column="Director" javaType="String"/>
        <result property="Mail_address" column="Mail_address" javaType="String"/>
        <result property="Telphone" column="Telphone" javaType="String"/>   
        <result property="Postalcode" column="Postalcode" javaType="String"/>
        <result property="Address" column="Address" javaType="String"/>
        <result property="Ondate" column="Ondate" javaType="java.util.Date"/>  
        <result property="Offdate" column="Offdate" javaType="java.util.Date"/>  
        <result property="Remark" column="Remark" javaType="String"/>    	
    </resultMap>
    <!-- 台网信息查询 -->
	<select id="queryNetworkInfo" parameterClass="quake.seismic.data.catalog.model.Criteria"
		resultMap="queryNetworkInfoResult">    
		<![CDATA[
		SELECT Net_code,Net_cname,Net_sname,Net_Lat,Net_lon,Net_elev,Net_type,Net_startdate,Net_enddate,
				Sta_num,Director,Mail_address,Telphone,Postalcode,Address,Ondate,Offdate,Remark
		FROM $schema$.Network_info
		WHERE 1=1
		]]>
		<dynamic>
		    <!-- 台网代码查询条件 -->
		    <isNotEmpty prepend="AND" property="netCode">
		       <![CDATA[(Net_code=#netCode#)]]>
		    </isNotEmpty>
		</dynamic>
	</select>
</sqlMap>